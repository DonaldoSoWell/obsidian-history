/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var N=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var j=(a,n)=>{for(var e in n)N(a,e,{get:n[e],enumerable:!0})},z=(a,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of X(n))!Y.call(a,i)&&i!==e&&N(a,i,{get:()=>n[i],enumerable:!(t=$(n,i))||t.enumerable});return a};var Z=a=>z(N({},"__esModule",{value:!0}),a);var h=(a,n,e)=>new Promise((t,i)=>{var r=c=>{try{l(e.next(c))}catch(p){i(p)}},s=c=>{try{l(e.throw(c))}catch(p){i(p)}},l=c=>c.done?t(c.value):Promise.resolve(c.value).then(r,s);l((e=e.apply(a,n)).next())});var te={};j(te,{default:()=>R});module.exports=Z(te);var O=require("obsidian");var W=require("@codemirror/state");var ne=new Error("timeout while waiting for mutex to become available"),re=new Error("mutex already locked"),J=new Error("request for lock canceled"),V=function(a,n,e,t){function i(r){return r instanceof e?r:new e(function(s){s(r)})}return new(e||(e=Promise))(function(r,s){function l(o){try{p(t.next(o))}catch(u){s(u)}}function c(o){try{p(t.throw(o))}catch(u){s(u)}}function p(o){o.done?r(o.value):i(o.value).then(l,c)}p((t=t.apply(a,n||[])).next())})},F=class{constructor(n,e=J){if(this._maxConcurrency=n,this._cancelError=e,this._queue=[],this._waiters=[],n<=0)throw new Error("semaphore must be initialized to a positive value");this._value=n}acquire(){let n=this.isLocked(),e=new Promise((t,i)=>this._queue.push({resolve:t,reject:i}));return n||this._dispatch(),e}runExclusive(n){return V(this,void 0,void 0,function*(){let[e,t]=yield this.acquire();try{return yield n(e)}finally{t()}})}waitForUnlock(){return V(this,void 0,void 0,function*(){return this.isLocked()?new Promise(e=>this._waiters.push({resolve:e})):Promise.resolve()})}isLocked(){return this._value<=0}release(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){let n=this._currentReleaser;this._currentReleaser=void 0,n()}}cancel(){this._queue.forEach(n=>n.reject(this._cancelError)),this._queue=[]}_dispatch(){let n=this._queue.shift();if(!n)return;let e=!1;this._currentReleaser=()=>{e||(e=!0,this._value++,this._resolveWaiters(),this._dispatch())},n.resolve([this._value--,this._currentReleaser])}_resolveWaiters(){this._waiters.forEach(n=>n.resolve()),this._waiters=[]}},Q=function(a,n,e,t){function i(r){return r instanceof e?r:new e(function(s){s(r)})}return new(e||(e=Promise))(function(r,s){function l(o){try{p(t.next(o))}catch(u){s(u)}}function c(o){try{p(t.throw(o))}catch(u){s(u)}}function p(o){o.done?r(o.value):i(o.value).then(l,c)}p((t=t.apply(a,n||[])).next())})},w=class{constructor(n){this._semaphore=new F(1,n)}acquire(){return Q(this,void 0,void 0,function*(){let[,n]=yield this._semaphore.acquire();return n})}runExclusive(n){return this._semaphore.runExclusive(()=>n())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.release()}cancel(){return this._semaphore.cancel()}};var x=require("obsidian");var f=class{constructor(n,e=!1){this.name=n;this.isMe=e;this.occurences=[]}addOccurence(n){this.occurences.push(n)}removeAllOccurencesOfPath(n){this.occurences.filter(e=>e.path===n).forEach(e=>this.occurences.remove(e))}updatePath(n,e){this.occurences=this.occurences.filter(t=>t.path!==n)}hasOccurenceAt(n,e,t){return this.occurences.filter(r=>r.path===n).find(r=>r.startOccurence<=t&&t<r.endOccurence&&r.line.number===e)!=null}get isMentioned(){return this.occurences.length>0}};var H=new RegExp('(^"[\\p{L}0-9-_, ]*$)|(^[\\p{L}0-9-_,]*$)',"u"),q=new RegExp(/\[[ x]{1}\]/),B=new RegExp(/^\- \[x{1}\]/);function b(a,n){return new RegExp(ee(a,n).source+"|"+D(a).source,"gmu")}function D(a){return new RegExp(`(\\B${a}[\\p{L}0-9-_,]+|\\B${a}"[\\p{L}0-9-_, ]+")`,"gmu")}function ee(a,n){return new RegExp(`(\\B${a}${n})`,"gmu")}var M=class{constructor(n,e,t){this.metadataCache=n;this.vault=e;this.settings=t;this.subscribers=[];this.metadataCacheEventReferences=[],this.vaultEventReferences=[],this.mentions=new Map,this.mutex=new w,this.loadedAfterFirstResolve=!1,this.addMeMention(),this.subscribeToCache(),this.subscribeToVault()}getMentionAt(n,e,t){for(let i of this.mentions.values())if(i.hasOccurenceAt(n,e,t))return i}subscribe(n){this.subscribers.push(n)}unsubscribeAll(){this.subscribers=[]}loadVault(){return this.mutex.runExclusive(()=>h(this,null,function*(){yield Promise.all(this.vault.getMarkdownFiles().map(n=>this.indexFile(n)))}))}addMeMention(){let n=new f("Me",!0);this.mentions.set(n.name,n)}subscribeToCache(){let n=this.metadataCache.on("resolved",()=>h(this,null,function*(){this.loadedAfterFirstResolve||(this.loadedAfterFirstResolve=!0,yield this.loadVault())}));this.metadataCacheEventReferences.push(n);let e=this.metadataCache.on("changed",t=>{this.mutex.runExclusive(()=>{this.indexFile(t)})});this.metadataCacheEventReferences.push(e)}subscribeToVault(){let n=this.vault.on("create",i=>{i instanceof x.TFile&&this.mutex.runExclusive(()=>{this.indexFile(i)})});this.vaultEventReferences.push(n);let e=this.vault.on("delete",i=>{i instanceof x.TFile&&this.mutex.runExclusive(()=>{this.removeCurrentPathFromAllMentions(i.path)})});this.vaultEventReferences.push(e);let t=this.vault.on("rename",(i,r)=>{i instanceof x.TFile&&this.mutex.runExclusive(()=>{this.mentions.forEach(s=>{s.updatePath(r,i.path)})})});this.vaultEventReferences.push(t)}indexFile(n){return h(this,null,function*(){let t=(yield this.vault.cachedRead(n)).split(`
`),i=W.Text.of(t),r=n.path;this.removeCurrentPathFromAllMentions(r),t.forEach((s,l)=>{let c=this.getMatches(s),p=l+1;c.forEach(o=>{var I;let u=this.addToMentions(o),P={line:i.line(p),startOccurence:o.index,endOccurence:o.index+o[0].length,path:r,text:o.input,isTaskComplete:((I=o.input.trimStart().match(B))==null?void 0:I.length)>0||!1};u.addOccurence(P)})}),this.notifySubscribers()})}notifySubscribers(){this.subscribers!=null&&this.subscribers.forEach(n=>{n()})}removeCurrentPathFromAllMentions(n){this.mentions.forEach(e=>{e.removeAllOccurencesOfPath(n),!e.isMentioned&&!e.isMe&&this.mentions.delete(e.name)})}getMatches(n){return[...n.matchAll(D(this.settings.mentionTriggerPhrase))]}addToMentions(n){let e=n[0].replace(new RegExp(this.settings.mentionTriggerPhrase),""),t=this.mentions.get(e);return t||(t=new f(e),this.mentions.set(e,t)),t}};var G=require("@codemirror/state"),y=require("@codemirror/view");var d="ch.der-tobi.obsidian-simple-mention",C="mention",E="me_mention";function U(a,n,e){return y.ViewPlugin.fromClass(class{constructor(i){this.decorations=this.addDecorations(i)}update(i){(i.docChanged||i.viewportChanged)&&(this.decorations=this.addDecorations(i.view))}addDecorations(i){let r=new G.RangeSetBuilder,s=n.regexp;for(let{from:l,to:c}of i.visibleRanges){let p=i.state.sliceDoc(l,c),o;for(;o=s.exec(p);)r.add(l+o.index,l+o.index+o[0].length,y.Decoration.mark({class:o[1]!=null?E:o[2]!=null?C:""}))}return r.finish()}destroy(){}},{decorations:i=>i.decorations,eventHandlers:{keydown:(i,r)=>{if(i.code==="Space"&&i.ctrlKey){let s=r.state.selection.asSingle().main.from,l=r.state.doc.lineAt(s),c=s-l.from,p=a.workspace.getActiveFile().path;n.keyDownHandler(l.number,c,p)}},mousedown:(i,r)=>{let s=i.target;if(i.ctrlKey&&s&&(i.target.hasClass(C)||i.target.hasClass(E))){let l=r.posAtCoords({x:i.x,y:i.y}),c=r.state.doc.lineAt(l),p=l-c.from,o=a.workspace.getActiveFile().path;n.keyDownHandler(c.number,p,o)}}}})}function K(){return{iconId:"at",svgContent:'<path stroke="currentColor" fill="currentColor" d="M42.1465 31.1818L42.1466 31.1819L42.1573 31.178C44.3692 30.3753 47.2089 29.9641 50.6945 29.9641C55.4446 29.9641 58.9145 31.0529 61.1958 33.1427C63.4688 35.225 64.6468 38.3799 64.6468 42.7037V59.8495C64.6468 62.0655 65.2338 63.817 66.4928 65.0079C67.7465 66.194 69.5818 66.743 71.9057 66.743C74.7017 66.743 76.9231 65.7044 78.5078 63.6146C80.0422 61.591 81.1176 59.0917 81.7471 56.1329C82.3716 53.1983 82.6843 50.2912 82.6843 47.4122C82.6843 39.418 81.0684 33.1134 77.7756 28.5566C74.5738 23.9816 70.5141 20.7485 65.6 18.8751C60.7918 17.0186 55.9459 16.0882 51.065 16.0882C41.0105 16.0882 32.7594 19.237 26.3562 25.5586C19.951 31.8228 16.7596 39.9518 16.7596 49.8996C16.7596 57.0827 18.383 63.1935 21.657 68.2056C24.9155 73.1939 29.151 76.9571 34.3593 79.4852C39.6161 82.066 45.2486 83.3557 51.2502 83.3557C54.8136 83.3557 58.3752 82.8762 61.934 81.9185C64.682 81.2365 67.2027 80.2777 69.4938 79.0402C70.4372 78.5306 71.607 78.836 72.1009 79.7241C72.5591 80.5481 72.2864 81.5624 71.4952 81.9971C68.896 83.4252 65.994 84.5899 62.7868 85.4891L62.7868 85.489L62.7783 85.4915C58.8754 86.6613 54.7556 87.2474 50.4166 87.2474C43.3306 87.2474 36.8987 85.6663 31.1107 82.5108L31.1073 82.5089C25.3181 79.4112 20.7214 75.0897 17.3099 69.539C13.9053 63.9994 12.1965 57.6064 12.1965 50.3438C12.1965 43.3181 13.8437 36.9488 17.1322 31.2248L17.1333 31.2229C20.4247 25.4354 24.9634 20.8187 30.7567 17.3679C36.5369 13.9248 43.2085 12.1965 50.7871 12.1965C56.1549 12.1965 61.6533 13.2494 67.285 15.363L67.2866 15.3636C72.9403 17.4626 77.6821 20.9595 81.5175 25.8643C85.3197 30.7266 87.2474 37.2996 87.2474 45.6354C87.2474 49.3794 86.729 53.1554 85.6903 56.9647C84.6604 60.7413 82.9086 63.8926 80.441 66.4323L80.4368 66.4368C78.0809 68.9224 74.7965 70.1905 70.5163 70.1905C67.3265 70.1905 64.7892 69.4126 62.8603 67.9001C61.7771 67.0251 60.029 66.4349 58.324 66.2533C56.6311 66.073 54.8164 66.2788 53.6672 67.18C53.4775 67.3288 53.2835 67.4763 53.0854 67.6225C50.774 69.3278 47.9788 70.1905 44.6739 70.1905C41.9307 70.1905 39.1734 69.4192 36.3963 67.8558C33.7585 66.3709 32.3888 63.6687 32.3888 59.583C32.3888 56.3658 33.3134 54.002 35.0921 52.4044C36.9928 50.7533 39.379 49.6325 42.2697 49.0548C45.2636 48.4688 48.2878 48.1759 51.3429 48.1759C52.5699 48.1759 53.797 48.2053 55.0241 48.2641C57.2191 48.3694 59.0649 46.6218 59.0649 44.4209V44.214C59.0649 41.1284 58.4031 38.6162 57.0264 36.7281C55.5987 34.7094 53.1227 33.7669 49.7682 33.7669C47.1167 33.7669 44.6569 34.2606 42.3951 35.2536C40.9 35.9101 39.9438 37.3002 39.5552 38.8108L38.9064 41.3327C38.6525 42.3193 37.7127 42.9697 36.6999 42.8598C35.518 42.7314 34.6929 41.6279 34.904 40.4579L35.6103 36.5441C35.8917 34.9843 36.7777 33.6113 38.1331 32.8977C39.4115 32.2247 40.7492 31.6527 42.1465 31.1818ZM40.9717 64.7056L40.9806 64.7115L40.9897 64.717C42.7331 65.7698 44.6125 66.2988 46.619 66.2988C49.6513 66.2988 52.4481 65.2123 54.997 63.0732L54.9977 63.0726C57.6417 60.846 59.0005 57.9554 59.0648 54.4394L58.5676 54.4304H59.0649C59.0649 52.6155 57.6924 51.0649 55.8517 50.9583C55.5687 50.9419 55.2813 50.9271 54.9892 50.9137C53.6821 50.7946 52.4049 50.735 51.1576 50.735C47.9571 50.735 45.0545 51.2464 42.4571 52.2785C41.104 52.7859 40.0625 53.5983 39.3652 54.7237C38.6707 55.8447 38.3412 57.238 38.3412 58.8722C38.3412 61.5259 39.1842 63.5187 40.9717 64.7056Z"/>'}}var S=require("obsidian");var T=class extends S.EditorSuggest{constructor(e,t,i){super(e);this.app=e;this.cache=t;this.settings=i}onTrigger(e,t,i){let r=t.getLine(e.line).substring(0,e.ch);if(!r.contains(this.settings.mentionTriggerPhrase))return;let s=r.split(this.settings.mentionTriggerPhrase).reverse()[0],l=[...r.matchAll(new RegExp(this.settings.mentionTriggerPhrase,"g"))].reverse()[0].index;return r.slice(l-1,l)!==" "&&r.slice(l-1,l)!==""||!H.test(s)?void 0:{start:{ch:l,line:e.line},end:e,query:s}}getSuggestions(e){let t=this.getMentionSuggestions(e);return t.length?t.sort(this.completitionComparer):[{label:e.query,value:e.query}].sort(this.completitionComparer)}renderSuggestion(e,t){t.setText(e.label)}selectSuggestion(e,t){let i=this.app.workspace.getActiveViewOfType(S.MarkdownView),r=i.editor.getCursor(),s=e.value+" ",l={ch:r.ch+s.length,line:r.line};!i||(i.editor.replaceRange(s,{ch:this.context.start.ch+this.settings.mentionTriggerPhrase.length,line:this.context.start.line},this.context.end),i.editor.setCursor(l))}getMentionSuggestions(e){let t=[];for(let i of this.cache.mentions.keys())i.toLocaleLowerCase().contains(e.query.toLocaleLowerCase())&&t.push(this.cache.mentions.get(i).name);return t.map(i=>({label:i.replace(/["]/g,""),value:i}))}completitionComparer(e,t){return e.label.toLowerCase()<t.label.toLowerCase()?-1:e.label.toLowerCase()>t.label.toLowerCase()?1:0}};var L=require("obsidian");var g=class extends L.ItemView{constructor(e,t){super(e);this.cache=t;this.mentionSelect="";this.includeCompleted=!1;this.options=[];this.mentions=t.mentions,this.cache.loadVault(),this.initRender()}getViewType(){return d}getDisplayText(){return"Mention"}getIcon(){return"at"}updateView(){this.renderOptions(),this.renderList()}selectMentionByKey(e){let t=this.options.find(i=>i.value===e);t!=null&&(t.selected=!0,this.mentionSelect=t.value,this.renderList()),this.app.workspace.revealLeaf(this.leaf)}initRender(){this.renderContainers(),this.renderSelect(),this.renderSimpleFilter(),this.renderIncludeComplededTasksCheckbox(),this.renderOptions(),this.renderList()}renderContainers(){this.viewContent=this.containerEl.children[1],this.viewContent.empty(),this.container=this.viewContent.createDiv("mention-view-container"),this.controlsContainer=this.container.createDiv("mention-view-controls-container"),this.listContainer=this.container.createDiv("mention-view-list-container")}renderSelect(){this.controlsContainer.empty(),this.controlsContainer.createDiv("mention-view-select",e=>{this.select=document.createElement("select"),this.select.addClass("dropdown"),this.select.addEventListener("change",t=>{this.mentionSelect=t.target.value,this.renderList()}),e.appendChild(this.select)})}renderSimpleFilter(){this.controlsContainer.createDiv("mention-view-simplefilter",e=>{this.simpleFilterInput=document.createElement("input"),this.simpleFilterInput.addClass("simplefilter"),this.simpleFilterInput.setAttr("type","text"),this.simpleFilterInput.placeholder="Filter...",this.simpleFilterInput.addEventListener("keyup",t=>{this.renderList()}),e.appendChild(this.simpleFilterInput)})}renderIncludeComplededTasksCheckbox(){this.controlsContainer.createDiv("mention-view-includeCompleted",e=>{this.includeCompletedLabel=document.createElement("div"),this.includeCompletedLabel.innerText="Include completed tasks",this.includeCompletedCheckbox=document.createElement("div"),this.includeCompletedCheckbox.addClass("checkbox-container"),this.includeCompletedCheckbox.addEventListener("click",t=>{this.includeCompleted=!this.includeCompleted,this.includeCompletedCheckbox.toggleClass("is-enabled",this.includeCompleted),this.renderList()}),e.appendChild(this.includeCompletedLabel),e.appendChild(this.includeCompletedCheckbox)})}renderOptions(){this.select.empty(),this.options=[];let e=document.createElement("option");e.value="Select all @mentions",e.text="Select all @mentions",e.selected=this.mentionSelect=="Select all @mentions",this.options.push(e),this.select.appendChild(e),[...this.mentions.keys()].sort(this.mentionLabelComparer).forEach(i=>{let r=this.mentions.get(i),s=document.createElement("option");s.value=i,s.text=r.name,s.selected=this.mentionSelect==i,this.options.push(s),this.select.appendChild(s)})}renderList(){this.listContainer.empty(),this.listContainer.createDiv("mention-view-item-list",e=>{var t;if(this.mentions!=null){let i=this.mentions.get(this.mentionSelect),r;this.select.value==="Select all @mentions"?(r=[...(t=this.mentions)==null?void 0:t.values()].flatMap(s=>s.occurences),r=[...new Map(r.map(s=>[s.path+":"+s.line.from+":"+s.line.from,s])).values()],r==null||r.sort(this.occurenceComparer).forEach(s=>{this.filterAndRenderMentions(s,e)})):(i==null?void 0:i.occurences.length)>0&&(r=i.occurences,r=[...new Map(r.map(s=>[s.path+":"+s.line.from+":"+s.line.from,s])).values()],r==null||r.sort(this.occurenceComparer).forEach(s=>{this.filterAndRenderMentions(s,e)}))}})}filterAndRenderMentions(e,t){!this.includeCompleted&&e.isTaskComplete||(this.simpleFilterInput.value==null||this.simpleFilterInput.value!=null&&e.text.toLocaleLowerCase().contains(this.simpleFilterInput.value.toLocaleLowerCase()))&&this.renderOccurence(t,e)}renderOccurence(e,t){e.createDiv("mention-view-item",i=>{L.MarkdownRenderer.renderMarkdown(t.text.trimStart(),i,t.path,this),this.registerTodoCheckboxClick(i,t),this.registerItemClick(i,t),i.createDiv("mention-view-item-file",r=>{r.innerText=t.path})})}occurenceComparer(e,t){return e.path===t.path?e.line.number-t.line.number:e.path>t.path?1:-1}mentionLabelComparer(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0}registerTodoCheckboxClick(e,t){var i;(i=e.getElementsByTagName("input")[0])==null||i.addEventListener("input",r=>h(this,null,function*(){let s=`
`,l=r.target.checked,c=this.app.vault.getAbstractFileByPath(t.path),o=(yield this.app.vault.read(c)).split(s);o[t.line.number-1]=o[t.line.number-1].replace(q,`${l?"[x]":"[ ]"}`),this.app.vault.modify(c,o.join(s)),r.stopPropagation()}))}registerItemClick(e,t){e.onClickEvent(i=>h(this,null,function*(){let r=this.app.vault.getAbstractFileByPath(t.path),s=this.app.workspace,l=yield this.app.vault.read(r);s.getLeaf(s.getActiveFile()&&s.getActiveFile().path!==t.path).openFile(r,{active:!0,eState:{match:{content:l,matches:[[t.line.from+t.startOccurence,t.line.from+t.endOccurence]]}}})}))}};var _=class{constructor(n,e){this.element=n;this.settings=e;this.subscribers=[];this.meMentionOrMentionRegex=void 0;this.meMentionOrMentionRegex=b(this.settings.mentionTriggerPhrase,this.settings.meMentionName)}subscribeToMentionClick(n){this.subscribers.push(n)}addPreviewMentionStyle(){if(this.element.firstChild instanceof Node){let n=this.getChildNodes(this.element);for(let e of n){let t=this.getReplacementNodesOrNull(e.textContent,this.meMentionOrMentionRegex);t&&e.replaceWith(...t)}}}getChildNodes(n){let e=document.createTreeWalker(n.firstChild,NodeFilter.SHOW_TEXT,null),t=[],i;for(;i=e.nextNode();)t.push(i);return t}getReplacementNodesOrNull(n,e){let t=[...n.matchAll(e)];if(t.length>0){let i=[],r=n.substring(0,t[0].index);return i.push(r),t.forEach((s,l)=>{let c=s[1]!=null?E:s[2]!=null?C:"",p=this.surroundWithAnchorTag(s[0],c);i.push(p);let o=t[l+1]==null?n.length:t[l+1].index,u=s.index+s[0].length,P=n.substring(u,o);i.push(P)}),i}return null}surroundWithAnchorTag(n,e){let t=document.createElement("a");return t.addClass(e,"preview"),t.textContent=n,t.onClickEvent(i=>{this.subscribers.forEach(r=>r(n))}),t}};var m=require("obsidian"),v={mentionTriggerPhrase:"@",mentionStyleColor:"green",meMentionName:"Me",meMentionStyleColor:"deeppink"},k=class extends m.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new m.Setting(e).setName("Mention trigger").setDesc("Leave this blank if you want to use the default value (@). Please reload Obsidian after changing this value.").addText(t=>{t.setPlaceholder("@"),t.setValue(this.plugin.settings.mentionTriggerPhrase).onChange(i=>{this.plugin.settings.mentionTriggerPhrase=i,i===""&&(this.plugin.settings.mentionTriggerPhrase=v.mentionTriggerPhrase),this.plugin.saveSettings()})}),new m.Setting(e).setName("Mention style color").setDesc("Default/empty is green. You can insert a Hex (#00ff00) or a CSS color (green).").addText(t=>{t.setPlaceholder("green"),t.setValue(this.plugin.settings.mentionStyleColor).onChange(i=>{this.plugin.settings.mentionStyleColor=i,i===""&&(this.plugin.settings.mentionStyleColor=v.mentionStyleColor),this.plugin.saveSettings()})}),new m.Setting(e).setName("Mention yourself").setDesc('Default/empty is "Me" (@Me). Please reload Obsidian after changing this value.').addText(t=>{t.setPlaceholder("Me"),t.setValue(this.plugin.settings.meMentionName).onChange(i=>{this.plugin.settings.meMentionName=i,i===""&&(this.plugin.settings.meMentionName=v.meMentionName),this.plugin.saveSettings()})}),new m.Setting(e).setName("Mention yourself style color").setDesc("Default/empty is deeppink. You can insert a Hex (#FF1493) or a CSS color (deeppink).").addText(t=>{t.setPlaceholder("deeppink"),t.setValue(this.plugin.settings.meMentionStyleColor).onChange(i=>{this.plugin.settings.meMentionStyleColor=i,i===""&&(this.plugin.settings.meMentionStyleColor=v.meMentionStyleColor),this.plugin.saveSettings()})})}};var A=class{constructor(n){this.settings=n;this.style=document.createElement("style")}appendStyle(){let n=`
            :root {
                --mention_color: ${this.settings.mentionStyleColor};
                --me_mention_color: ${this.settings.meMentionStyleColor};
            }

            .me_mention {
                color: var(--me_mention_color);
                border: 1px var(--me_mention_color) solid;
                border-radius: 5px;
                padding: 0px .2em 0px 0.05em;
                text-decoration: none;
            }

            .me_mention.preview:hover {
                filter:brightness(130%);
                color: var(--me_mention_color);
                cursor: pointer;
            }

            .mention {
                color: var(--mention_color);
                border: 1px var(--mention_color) solid;
                border-radius: 5px;
                padding: 0px .2em 0px 0.05em;
                text-decoration: none;
            }

            .mention.preview:hover {
                filter:brightness(130%);
                color: var(--mention_color);
                cursor: pointer;
            }

            .mention-view-item {
                cursor: pointer;
                border-radius: 3px;
                position: relative;
                white-space: pre-wrap;
                color: var(--text-normal);
                background: var(--background-search-result);
                padding: 3px 9px;
                margin-bottom: 10px;
            }

            .mention-view-item ul {
                margin-block-start: 0px;
                margin-block-end: 0px;
                line-height: normal;
            }

            .mention-view-item-file {
                font-size: 0.8em;
                border-top: solid 1px;
                filter: brightness(0.5);
            }

            .mention-view-controls-container {
                padding: 0px 0px 20px 0px;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .mention-view-select select {
                width: 100%;
            }

            .mention-view-simplefilter input {
                width: 100%;
            }

            .mention-view-includeCompleted {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        `;this.style.appendChild(document.createTextNode(n)),document.getElementsByTagName("head")[0].appendChild(this.style)}removeStyle(){document.getElementsByTagName("head")[0].removeChild(this.style)}updateStyle(){this.removeStyle(),this.appendStyle()}};var R=class extends O.Plugin{onload(){return h(this,null,function*(){yield this.loadSettings(),this.addAtIcon(),this.addStyle(),this.cache=new M(this.app.metadataCache,this.app.vault,this.settings),this.registerView(d,e=>{let t=new g(e,this.cache);return this.cache.subscribe(t.updateView.bind(t)),t}),this.initMentionView(),this.registerMarkdownPostProcessor(e=>{let t=new _(e,this.settings);t.addPreviewMentionStyle(),t.subscribeToMentionClick(this.previewClickHandler.bind(this))}),this.registerEditorExtension(U(this.app,{regexp:b(this.settings.mentionTriggerPhrase,this.settings.meMentionName),keyDownHandler:this.searchForMention.bind(this),mouseDownHandler:this.searchForMention.bind(this)},this.settings)),this.addSettingTab(new k(this.app,this)),this.registerEditorSuggest(new T(this.app,this.cache,this.settings))})}initMentionView(){this.app.workspace.onLayoutReady(()=>{this.app.workspace.getLeavesOfType(d).length||this.app.workspace.getRightLeaf(!1).setViewState({type:d})})}onunload(){this.cache.unsubscribeAll(),this.style!=null&&this.style.removeStyle(),this.app.workspace.getLeavesOfType(d).forEach(e=>e.detach())}loadSettings(){return h(this,null,function*(){this.settings=Object.assign({},v,yield this.loadData())})}saveSettings(){return h(this,null,function*(){yield this.saveData(this.settings),this.style.updateStyle()})}addAtIcon(){let e=K();(0,O.addIcon)(e.iconId,e.svgContent)}addStyle(){this.style=new A(this.settings),this.style.appendStyle()}previewClickHandler(e){return h(this,null,function*(){yield this.activateMentionView(),this.app.workspace.getActiveViewOfType(g).selectMentionByKey(e.replace(this.settings.mentionTriggerPhrase,""))})}searchForMention(e,t,i){return h(this,null,function*(){var r;yield this.activateMentionView(),this.app.workspace.getActiveViewOfType(g).selectMentionByKey((r=this.cache.getMentionAt(i,e,t))==null?void 0:r.name)})}activateMentionView(){return h(this,null,function*(){this.app.workspace.detachLeavesOfType(d),yield this.app.workspace.getRightLeaf(!1).setViewState({type:d,active:!0}),this.app.workspace.revealLeaf(this.app.workspace.getLeavesOfType(d)[0])})}};
